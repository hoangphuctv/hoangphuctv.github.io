<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Go kết nối mongodb bằng thư viện mgo &middot; Tran Hoang Phuc</title>

  
  <link rel="stylesheet" href="https://hoangphuctv.github.io/css/poole.css">
  <link rel="stylesheet" href="https://hoangphuctv.github.io/css/hyde.css">
  <link rel="stylesheet" href="https://hoangphuctv.github.io/css/poole-overrides.css">
  <link rel="stylesheet" href="https://hoangphuctv.github.io/css/hyde-overrides.css">
  <link rel="stylesheet" href="https://hoangphuctv.github.io/css/hyde-x.css">
  <link rel="stylesheet" href="https://hoangphuctv.github.io/css/highlight/default.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://hoangphuctv.github.io/touch-icon-144-precomposed.png">
  <link href="https://hoangphuctv.github.io/favicon.png" rel="icon">

  
  
  
  

  <meta name="description" content="Blog lập trình">
  <meta name="keywords" content="lap trinh blog, go, php, linux">
  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-90002072-5', 'auto');
    ga('send', 'pageview');
  </script>
  
</head>
<body class="theme-base-0b">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      
      <h1>Tran Hoang Phuc</h1>
      
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="https://hoangphuctv.github.io/">Home</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      
      
      
      
      
      <a href="https://www.facebook.com/phucth.vn"><i class="fa fa-facebook-square fa-3x"></i></a>
      
      
      <a href="https://hoangphuctv.github.io/index.xml" type="application/rss+xml"><i class="fa fa-rss-square fa-3x"></i></a>
      </li>
    </ul>

    

    <p>Copyright &copy; 2019 <a href="https://hoangphuctv.github.io/license/">License</a><br/>
       Powered by <a href="http://gohugo.io">Hugo</a> and <a href="https://github.com/zyro/hyde-x">Hyde-X</a></p>

  </div>
</div>


<div class="content container">
  <div class="post">
    <h1 class="post-title">Go kết nối mongodb bằng thư viện mgo</h1>
    <span class="post-date">Apr 8, 2019 &middot; 2 minute read
    

    
    <br/>
    <a class="label" href="https://hoangphuctv.github.io/categories/l%E1%BA%ADp-tr%C3%ACnh-go">Lập trình GO</a>
    </span>
    

<p><code>mgo</code> là một thư viện của Go, giúp Go tương tác với mongodb. Với cú pháp đơn giản và dễ sử dụng.</p>

<h2 id="cài-đặt">Cài đặt</h2>

<p>Để cài đặt bạn gõ lệnh trên terminal:</p>

<pre><code>$ go get gopkg.in/mgo.v2
</code></pre>

<h2 id="sử-dụng">Sử dụng</h2>

<p>Để sử dụng bạn import thư viện vào:</p>

<pre><code>import (
  &quot;gopkg.in/mgo.v2&quot;
  &quot;gopkg.in/mgo.v2/bson&quot;
)
</code></pre>

<h3 id="kết-nối-với-mongodb">Kết nối với mongodb</h3>

<p>Sau khi import bạn thực hiện kết nối bằng method <code>Dial</code>, method này trả về kết quả là thông tin kết nối và lỗi nếu có:</p>

<pre><code>session, err := mgo.Dial(&quot;127.0.0.1:2701&quot;)
if err != nil {
        panic(err)
}
defer session.Close()
</code></pre>

<p>Để tương tác với collection dùng lệnh:</p>

<pre><code>collection := session.DB(&quot;test&quot;).C(&quot;ten_collection&quot;)
</code></pre>

<h2 id="tương-tác-với-csdl">Tương tác với CSDL</h2>

<h3 id="tạo-mới-document">Tạo mới document</h3>

<p>Để tương tác với các document trong mongodb, chúng ta cần có các structs dùng để  &ldquo;định hình&rdquo; các document. Nếu bạn chưa biết về struct có thể xem thêm tại các bài viết về golang basic.</p>

<p><em>Ví dụ:</em> ta cần quản lí  document  với struct như sau:</p>

<pre><code>type Person struct {
        Name string
        Phone string
}
</code></pre>

<h4 id="tạo-mới-document-bằng-các-sử-dụng-struct">Tạo mới document bằng các sử dụng struct</h4>

<pre><code>p1 := &amp;Person{&quot;Ale&quot;, &quot;+55 53 8116 9639&quot;}
collection.Insert(p1)
</code></pre>

<h4 id="tạo-mới-document-không-cần-có-struct">Tạo mới document không cần có struct</h4>

<pre><code>p1 := bson.M{&quot;Name&quot; : &quot;Ale&quot;, &quot;Phone&quot; : &quot;+55 53 8116 9639&quot;}
collection.Insert(p1)
</code></pre>

<p><em>Lưu ý</em>:</p>

<ul>
<li><code>_id</code> được  tự động thêm vào.</li>
<li>Khi tạo mới document, mgo không trả về <code>_id</code> của  document vừa tạo.</li>
</ul>

<h2 id="kết-quả">Kết quả:</h2>

<p>Chương trình sau sẽ khai báo struct <code>People</code> và thực hiện <code>Insert</code>,  <code>Find</code>, <code>Delete</code>, <code>Update</code></p>

<pre><code>package main

import (
        &quot;fmt&quot;
        &quot;log&quot;
        &quot;gopkg.in/mgo.v2&quot;
        &quot;gopkg.in/mgo.v2/bson&quot;
)

type Person struct {
        Name string
        Phone string
}

func main() {
        session, err := mgo.Dial(&quot;127.0.0.1:2701&quot;)
        if err != nil {
                panic(err)
        }
        defer session.Close()

        // Optional. Switch the session to a monotonic behavior.
        session.SetMode(mgo.Monotonic, true)

        peopleCollection := session.DB(&quot;test&quot;).C(&quot;people&quot;)

        p1 := &amp;Person{&quot;Ale&quot;, &quot;+55 53 8116 9639&quot;}
        p2 := &amp;Person{&quot;Cla&quot;, &quot;+55 53 8402 8510&quot;}

        err = peopleCollection.Insert(p1, p2)
        if err != nil {
                log.Fatal(err)
        }

        resultPeople := Person{}
        err = c.Find(bson.M{&quot;name&quot;: &quot;Ale&quot;}).One(&amp;resultPeople)
        if err != nil {
                log.Fatal(err)
        }

        fmt.Println(&quot;Name:&quot;, resultPeople.Name)
        fmt.Println(&quot;Phone:&quot;, resultPeople.Phone)
}
</code></pre>

  </div>
  

  

</div>




<script src="https://hoangphuctv.github.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>

